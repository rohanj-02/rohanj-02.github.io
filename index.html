<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" type="text/css" href="main.css" />
		<link
			href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap"
			rel="stylesheet"
		/>
		<title>Portfolio</title>
		<script type="module">
			import { Octokit } from "https://cdn.pika.dev/@octokit/core";
			import GITHUB_AUTH_KEY from "./config.js";

			const octokit = new Octokit({ auth: `${GITHUB_AUTH_KEY}` });

			const stats = {
				day: {
					py: { additions: 0, deletions: 0 },
					js: { additions: 0, deletions: 0 },
					java: { additions: 0, deletions: 0 },
					c: { additions: 0, deletions: 0 },
					html: { additions: 0, deletions: 0 },
					css: { additions: 0, deletions: 0 },
				},
				week: {
					py: { additions: 0, deletions: 0 },
					js: { additions: 0, deletions: 0 },
					java: { additions: 0, deletions: 0 },
					c: { additions: 0, deletions: 0 },
					html: { additions: 0, deletions: 0 },
					css: { additions: 0, deletions: 0 },
				},

				month: {
					py: { additions: 0, deletions: 0 },
					js: { additions: 0, deletions: 0 },
					java: { additions: 0, deletions: 0 },
					html: { additions: 0, deletions: 0 },
					css: { additions: 0, deletions: 0 },
					c: { additions: 0, deletions: 0 },
				},
			};

			async function getOneCommit(owner, repo, ref) {
				const response = await octokit.request(
					"GET /repos/{owner}/{repo}/commits/{ref}",
					{
						owner: owner,
						repo: repo,
						ref: ref,
					}
				);
				const files = response.data.files;
				const curr_date = new Date();
				const commit_date = new Date(response.data.commit.author.date);
				const diff_in_time = curr_date.getTime() - commit_date.getTime();
				const diff_in_date = diff_in_time / (1000 * 3600 * 24);
				// console.log(diff_in_date);
				console.log(owner + "/" + repo + "/" + ref);
				if (diff_in_date <= 1) {
					files.forEach((file) => {
						if (file.filename.endsWith(".py")) {
							stats.day.py.additions += file.additions;
							stats.day.py.deletions += file.deletions;
						}
						if (file.filename.endsWith(".js")) {
							stats.day.js.additions += file.additions;
							stats.day.js.deletions += file.deletions;
						}
						if (file.filename.endsWith(".java")) {
							stats.day.java.additions += file.additions;
							stats.day.java.deletions += file.deletions;
						}
						if (
							file.filename.endsWith(".c") ||
							file.filename.endsWith(".cpp")
						) {
							stats.day.c.additions += file.additions;
							stats.day.c.deletions += file.deletions;
						}
						if (file.filename.endsWith(".html")) {
							stats.day.html.additions += file.additions;
							stats.day.html.deletions += file.deletions;
						}
						if (file.filename.endsWith(".css")) {
							stats.day.css.additions += file.additions;
							stats.day.css.deletions += file.deletions;
						}
					});
				}
				if (diff_in_date <= 7) {
					files.forEach((file) => {
						if (file.filename.endsWith(".py")) {
							stats.week.py.additions += file.additions;
							stats.week.py.deletions += file.deletions;
						}
						if (file.filename.endsWith(".js")) {
							stats.week.js.additions += file.additions;
							stats.week.js.deletions += file.deletions;
						}
						if (file.filename.endsWith(".java")) {
							stats.week.java.additions += file.additions;
							stats.week.java.deletions += file.deletions;
						}
						if (
							file.filename.endsWith(".c") ||
							file.filename.endsWith(".cpp")
						) {
							stats.week.c.additions += file.additions;
							stats.week.c.deletions += file.deletions;
						}

						if (file.filename.endsWith(".html")) {
							stats.week.html.additions += file.additions;
							stats.week.html.deletions += file.deletions;
						}
						if (file.filename.endsWith(".css")) {
							stats.week.css.additions += file.additions;
							stats.week.css.deletions += file.deletions;
						}
					});
				}
				if (diff_in_date <= 30) {
					files.forEach((file) => {
						if (file.filename.endsWith(".py")) {
							stats.month.py.additions += file.additions;
							stats.month.py.deletions += file.deletions;
						}
						if (file.filename.endsWith(".js")) {
							stats.month.js.additions += file.additions;
							stats.month.js.deletions += file.deletions;
						}
						if (file.filename.endsWith(".java")) {
							stats.month.java.additions += file.additions;
							stats.month.java.deletions += file.deletions;
						}
						if (
							file.filename.endsWith(".c") ||
							file.filename.endsWith(".cpp")
						) {
							stats.month.c.additions += file.additions;
							stats.month.c.deletions += file.deletions;
						}

						if (file.filename.endsWith(".html")) {
							stats.month.html.additions += file.additions;
							stats.month.html.deletions += file.deletions;
						}
						if (file.filename.endsWith(".css")) {
							stats.month.css.additions += file.additions;
							stats.month.css.deletions += file.deletions;
						}
					});
				}

				// console.log(stats);
			}

			async function getUserEvent(username, _callback) {
				const response = await octokit.request(
					"GET /users/{username}/events",
					{
						username: username,
						per_page: 100,
						page: 0,
					}
				);
				const filteredResponse = response.data.filter((event) => {
					const created_date = new Date(event.created_at);
					const curr_date = new Date();
					const diff_in_time =
						curr_date.getTime() - created_date.getTime();
					const diff_in_date = diff_in_time / (1000 * 3600 * 24);
					return (
						event.type === "PushEvent" &&
						event.actor.login === "rohanj-02" &&
						diff_in_date <= 30
					);
				});

				let commitSHAs = [];
				await filteredResponse.forEach((pushEvent) => {
					const repo_name = pushEvent.repo.name;
					const x = repo_name.split("/");
					commitSHAs = commitSHAs.concat(
						pushEvent.payload.commits.map((commit) => {
							const body = {
								owner: x[0],
								repo: x[1],
								ref: commit.sha,
							};
							return body;
						})
					);
				});
				console.log(commitSHAs);
				await commitSHAs.forEach((commit) => {
					getOneCommit(commit.owner, commit.repo, commit.ref);
					console.log(stats);
				});
				console.log(stats);
				// console.log(response);
				// console.log(filteredResponse);
				await _callback();
			}

			function updateHTML() {
				document.getElementsByClassName("last-day")[0].innerHTML =
					`<h3>Python</h3><p>${
						stats.day.py.additions - stats.day.py.deletions
					}</p>` +
					`<h3>Java</h3><p>${
						stats.day.java.additions - stats.day.java.deletions
					}</p>` +
					`<h3>JavaScript</h3><p>${
						stats.day.js.additions - stats.day.js.deletions
					}</p>`;
				document.getElementsByClassName("last-week")[0].innerHTML =
					`<h3>Python</h3><p>${
						stats.week.py.additions - stats.week.py.deletions
					}</p>` +
					`<h3>Java</h3><p>${
						stats.week.java.additions - stats.week.java.deletions
					}</p>` +
					`<h3>JavaScript</h3><p>${
						stats.week.js.additions - stats.week.js.deletions
					}</p>`;
				document.getElementsByClassName("last-month")[0].innerHTML =
					`<h3>Python</h3><p>${
						stats.month.py.additions - stats.month.py.deletions
					}</p>` +
					`<h3>Java</h3><p>${
						stats.month.java.additions - stats.month.java.deletions
					}</p>` +
					`<h3>JavaScript</h3><p>${
						stats.month.js.additions - stats.month.js.deletions
					}</p>`;
			}
			getUserEvent("rohanj-02", updateHTML);
		</script>
		<script type="text/javascript" src="script.js"></script>
	</head>
	<body>
		<div class="nav">
			<div class="contact_me">
				<a href="#">
					<img src="images/chat_icon.svg" alt="chat logo" />Contact Me
				</a>
			</div>
			<div class="nav_icons">
				<a href="https://github.com/rohanj-02"
					><img src="images/github_gray.svg" alt="github"
				/></a>
				<a href="https://www.linkedin.com/in/rohanj02/"
					><img src="images/linkedin_gray.svg" alt="linkedin"
				/></a>
			</div>
		</div>
		<div class="landing">
			<div class="landing_wrapper">
				<div class="landing_left">
					<h1>Rohan Jain.</h1>
					<p>
						Hello! My name is Rohan Jain. I am pursuing a degree in
						Bachelor of Technology specialising in Computer Science.
					</p>
					<ul>
						<li><p>Java</p></li>
						<li><p>Python</p></li>
						<li><p>C++</p></li>
						<li><p>Full Stack Web Developer</p></li>
					</ul>
				</div>
				<div class="landing_right">
					<img
						src="images/profile_image.png"
						alt="profile pic"
						width="300px"
					/>
				</div>
			</div>
			<img src="images/scroll_down.svg" alt="scroll down" class="scroll" />
		</div>

		<div class="skills">
			<h2>Skills</h2>
			<p>
				Worked with MERN Stack and made projects <br />
				in Python and Java.
			</p>
			<div class="programs">
				<img src="images/react_icon.svg" alt="React icon" />
				<img src="images/nodejs_icon.svg" alt="Nodejs icon" />
				<img
					src="images/mongodb_icon.svg"
					alt="MongoDB icon"
					style="width: 20px;"
				/>
				<img src="images/bootstrap_icon.svg" alt="Bootstrap icon" />
				<img src="images/java_icon.svg" alt="Java icon" />
				<img src="images/python_icon.svg" alt="Python icon" />
			</div>
		</div>

		<div class="work clearfix">
			<div class="work_text">
				<h1>Rummy Game</h1>
				<a href="https://github.com/rohanj-02/Rummy"
					><h5>View Project</h5></a
				>
				<div class="underline"></div>
			</div>
			<ul>
				<li>
					<a href="https://github.com/rohanj-02/Rummy"
						><img src="images/github_dark_icon.svg" alt="Github logo"
					/></a>
				</li>
			</ul>
			<a href="https://github.com/rohanj-02/Rummy">
				<img
					src="images/project1.png"
					alt="Project image"
					class="work_image"
				/>
			</a>
		</div>

		<div class="work2 clearfix">
			<div class="work_text">
				<h1>PIXELS</h1>
				<a href="https://rohan19095.wixsite.com/mysite"
					><h5>View Project</h5></a
				>
				<div class="underline"></div>
			</div>
			<ul>
				<li>
					<a href="https://github.com/rohanj-02/Pixels"
						><img src="images/github_dark_icon.svg" alt="Github logo"
					/></a>
				</li>
				<li>
					<a href="https://rohan19095.wixsite.com/mysite"
						><img src="images/globe_icon.svg" alt="Website logo"
					/></a>
				</li>
			</ul>
			<a href="https://rohan19095.wixsite.com/mysite">
				<img
					src="images/project2.png"
					alt="Project image"
					class="work_image"
				/>
			</a>
		</div>
		<div class="work clearfix third">
			<div class="work_text">
				<h1>Vocabulary Builder</h1>
				<a href="https://github.com/rohanj-02/random-word-thrower"
					><h5>View Project</h5></a
				>
				<div class="underline"></div>
			</div>
			<ul>
				<li>
					<a href="https://github.com/rohanj-02/random-word-thrower"
						><img src="images/github_dark_icon.svg" alt="Github logo"
					/></a>
				</li>
			</ul>
			<a href="https://github.com/rohanj-02/random-word-thrower">
				<img
					src="images/project3.png"
					alt="Project image"
					class="work_image"
				/>
			</a>
		</div>

		<div class="footer">
			<a href="https://github.com/rohanj-02/"
				><h3 class="blue">More on Github</h3></a
			>
			<div class="underline_small"></div>
		</div>
		<div class="stats">
			<div class="last-day">
				<h3 class="python"></h3>
			</div>
			<div class="last-week">
				<h3 class="java"></h3>
			</div>
			<div class="last-month">
				<h3 class="js"></h3>
			</div>
		</div>
	</body>
</html>
